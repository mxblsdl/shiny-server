---
title: "Temp Sensor"
output: 
  flexdashboard::flex_dashboard:
    orientation: rows
    vertical_layout: fill
    css: style.css
    theme:
      version: 4
runtime: shiny

---

```{r global, include=FALSE}
library(flexdashboard)
library(reticulate)
library(g2r)
library(shiny)
# library(shinymaterial)
# source("../tree-map/R/counter.R")

# Required calls an error if not able to load python
use_python(python = "/usr/bin/python3",required = T)
source_python("influx.py")

dat <- get_temperature_data(length = 7)

transform_data <- function(d) {
  d <- unlist(d, recursive = F)
  d <- lapply(d, as.data.frame)
  d <- do.call(rbind, d)
  return(d)
}

dat <- transform_data(dat)
```

```{r setup, include = FALSE, context = "server"}
bslib::bs_themer()
```

Inputs {.sidebar}
-----------------------------------------------------------------------

TODOs
1) render radio button in nice CSS
2) count up humidity
3) Add text to counter
4) 
```{r}
shiny::radioButtons("time",
                    "Select Time Frame",
                    choiceNames = c("3 Hours", "Day", "Week", "Month"),
                    choiceValues = c(3, 24, 24*7, 24*30),
                    inline = F
)
```


Row {.tabset .tabset-fade}
-----------------------------------------------------------------------

### Temperature

```{r}
renderG2({
  # React to radio inputs
  d <- dat[1:as.numeric(input$time), ]
  
  g2(d, asp(time, temperature)) %>% 
  fig_line()
})
```

### Humidity

```{r}
renderG2({
  # React to radio inputs
  d <- dat[1:as.numeric(input$time), ]
  
  g2(d, asp(time, humidity)) %>% 
  fig_line()
})
```

Row
------------------------------------------------------------------------

### Chart C
1) lighten side color
2) add shadow around bottom
```{r}
fluidRow(column(width = 6,
                div(
                  class = "boxxy",
                  p("Current Temperature"),
                  h2(class = "boxxy-value",
                     countup::countup(
                       dat[1, "temperature"], options = list(useEasing = T,
                                                             suffix = " Degrees")
                     ))
                ) # end div
                ), # end column
                column(width = 6,
                       div(
                         class = "boxxy",
                         p("Relative Humidity"),
                         h2(class = "boxxy-value",
                            countup::countup(dat[1, "humidity"], options = list(
                              useEasing = T,
                              suffix = " %"
                            )))
                       ) # end div
                       ) # end column
)
```

